{
    "collab_server" : "",
    "contents" : "---\ntitle: \"Analysis of the Vivo Energy Twitter Handle\"\noutput: html_notebook\n---\n\nIn the following notebook i carry out an analysis of the [Vivo Energy](https://twitter.com/vivoenergykenya) twitter handle.    \n \n\n```{r setup, include=FALSE}\nknitr::opts_chunk$set(echo = F, include = F)\n```\n\n\n```{r load libraries}\npack <- c(\"rtweet\",\"janitor\",\"wordcloud\",\"RColorBrewer\",\"tidyverse\",\"tidytext\",\"gridExtra\",\"wordcloud2\",\"lubridate\",\"ggthemes\")\n\npload <- function(x){\n  for( i in x ){\n    #  require returns TRUE invisibly if it was able to load package\n    if( ! require( i , character.only = TRUE ) ){\n      #  If package was not able to be loaded then install the package\n      install.packages( i , dependencies = TRUE )\n  }\n      #  Load package after installing\n      require( i , character.only = TRUE )\n    \n  }\n}\n\n suppressPackageStartupMessages( pload(pack) ) \n\n# declutter workspace\nrm(pack, pload)\n```\n\nUsing the R package Rtweet to access twitter's API, i obtained 3000 of the Vivo handle's tweets and stored them in a csv file.  \n\nTabulated below are the first 6 observations from the dataset.  \n\n```{r get tweets, eval=FALSE}\n\nvivo<- get_timeline(\"vivoenergykenya\", n= 3000)\nvivo<- janitor::remove_empty_cols(vivo)\n# notice capitalised V\nreadr::write_csv(vivo,\"vivotweets.csv\")\n\n# declutter workspace\nrm(vivo)\n\n```\n\n```{r readInData}\nvivo.tw <- read_csv(\"vivotweets.csv\",col_names = T)\nhead(vivo.tw, 6)\n```\n\n## What hashtags does the handle use?\n\nIn the first part of this analysis i analyse the most common hashtags the account uses.  \n\n```{r hashtags}\nhashtags <- vivo.tw$hashtags %>% unique() \nhashtags <- drop_na(hashtags %>% as.data.frame(stringsAsFactors=F))\nhead(hashtags %>% as_tibble(),8)\n```\n\nFrom the table above it is evident that some hashtags appear in more than one row. This is because of different formatting. Specifically, as seen in the table, the case matters. Not quite evident is that hashtags from retweets are included in the hashtags column. As my focus in this case is specifically on hashtags by the Vivo account retweet hashtags are excluded. Also some tweets contain several hashtags.\nTo get a more accurate account of the hashtags further wrangling is needed.  \n\n```{r}\nHtags <- unnest_tokens(vivo.tw,output = tags,input = hashtags,token = \"words\") %>% filter(!is_retweet==TRUE) %>% select(tags) %>% drop_na() %>% count(tags, sort=T)\ncolnames(Htags) <- c(\"Hashtags\",\"Tally\")\nhead(Htags,8)\n```\n\nIt is evident once again that some challenges remain. Particularly with regard to spelling. The oft confusing British vs American spelling quagmire. Case in point \"fuellingkenya\" vs \"fueling Kenya\". \n```{r}\nknitr::include_graphics(path = \"https://imgs.xkcd.com/comics/perl_problems.png\")\n```\nComment about the hashtags. Say the largest one. Do they all relate to marketing campaigns?  \nAs would be expected most of the hashtags relate to promotional campaigns with fuellingkenya leading by a healthy margin.  \nA better representation of the hashtags used by the Vivo account would be a wordcloud. This is implemented below.  \n\n```{r htags2Cloud}\n# checking if i can obtain a better wordcloud using wordcloud2\n library(wordcloud2)\noptions(stringsAsFactors = F)\nHtags2 <- Htags\nHtags2$Tally <- log(Htags$Tally) \ncolnames(Htags2) <- c(\"word\",\"freq\")\nwordcloud2(data = Htags2, size = 0.4 )\n# declutter workspace\nrm(Htags2)\n```\n\n\n```{r htagsCloud}\nset.seed(1234)\nwordcloud(Htags$Hashtags[1:60],(Htags$Tally)[1:60], scale = c(3,.4), max.words = 60,min.freq = 2,colors = brewer.pal(8,\"Dark2\"),rot.per = 0.25)\n```\n\n##What are the most popular tweets by Vivo Energy?\n\nTo answer this, I shall use two metrics; the favourite count and the retweet count.\nPlotting a scatter plot and augmenting it with a best fit line it is clear there exists a strong correlation between the two metrics.\n\n```{r scatterPlot}\npop <- vivo.tw %>% filter(!is_retweet==TRUE) %>% select(text,favorite_count,retweet_count)\nggplot(pop,aes(retweet_count,favorite_count)) +\n  geom_point(alpha=0.40) +\n  geom_smooth(method = \"lm\") +\n  labs(x=\"Retweet Count\",y=\"Favorite Count\") +\n  theme_solarized()\n```\nMethods for stat_smooth include: \"lm\", \"glm\", \"gam\", \"loess\", \"rlm\"  \n* gam - generalized additive models.  \n* loess - local pilynomial regression fitting.  \n\nNext i take a look at the distribution of both the retweet count and the favorite count using a histogram and a frequency polygon.  \n\n```{r freqPoly}\npop1 <- gather(pop,metric,tally,2:3)\n\nggplot(pop1 , aes(tally,colour= metric)) +\n  geom_freqpoly(binwidth=1 ,size=1) +\n  scale_colour_hue(labels = c(\"Favorite Count\",\"Retweet Count\") ) +\n  scale_x_continuous(breaks = c(seq.int(0,60,by = 10)) ) +\n  coord_cartesian(xlim = c(0,40)) +\n  labs(x=NULL,y=\"Count\",colour=\"Metric\",title=\"Distribution of Metrics\") +\n  theme_solarized() +\n  theme(panel.grid.minor.x = element_line(),\n        legend.position = \"top\",\n        plot.title = element_text(face = \"bold\"))\nrm(pop1)\n```\n\n```{r histogram}\n\nplot1<- ggplot(pop) +\n  geom_histogram(aes(favorite_count),binwidth=1,fill=\"firebrick3\",alpha=0.6,colour=\"slategrey\") +\n  coord_cartesian(xlim = c(0,40)) +\n  labs(x=NULL,y=\"Count\", title=\"Hist of Favorite Tweets\") +\n  theme_solarized() +\n  theme(panel.grid.major.x = element_blank(),\n        panel.grid.minor.x = element_blank(),\n        plot.title = element_text(face = \"bold\")\n  )\n\nplot2<- ggplot(pop) +\n  geom_histogram(aes(retweet_count),binwidth=1,fill=\"mediumslateblue\",alpha=0.6,colour=\"slategrey\") +\n  coord_cartesian(xlim = c(0,40)) +\n  labs(x=NULL,y=\"Count\", title=\"Hist of Retweets\") +\n  theme_solarized() +\n  theme(panel.grid.major.x = element_blank(),\n        panel.grid.minor.x = element_blank(),\n        plot.title = element_text(face = \"bold\")\n  )\ngrid.arrange(plot1,plot2, ncol=2 )\n\nrm(plot1,plot2)\n```\n Comment about distribution. Looks Chi-Squared? check. Or perhaps reverse exponential.  \nThe distribution of both metrics seems to resemble a chi-squared distrubution.   \nThe distribution of both metrics is skewed right i.e they have long tails to the right. Plot boxplot to obtain the median, first and third quartiles as well as outliers.  \n\n```{r metricTable}\npop2 <- pop %>% arrange(desc(favorite_count),desc(retweet_count))\nnames(pop2) <- c(\"Text\", \"Favorite Count\",\"Retweet Count\")\nhead(pop2,10)\nrm(pop2)\n```\nThe most popular tweets regard the shell fuel save challenge, comprising 5/10 of the top ten tweets. The mantle however, is taken by a tweet regarding coffee. Kenyans seem to really like their coffee especially on cold mornings.\n\n \n### What are the most popular words used by the handle?\n\n```{r popular words }\n#Remove links from tweets\npop_tidy <- pop \npop_tidy$text <- gsub('http.*\\\\s*', '', pop_tidy$text)\npop_tidy <- pop_tidy %>% unnest_tokens(word,text) %>% anti_join(stop_words, by=\"word\") %>% count(word,sort=TRUE)\nnames(pop_tidy) <- c(\"Word\",\"Tally\")\nhead(pop_tidy,10)\n```\n\nNot surprisingly the most common word used by the Vivo Energy twitter handle is \"shell\". Unfortunately, i do not have access to a list of Kiswahili stop words. This would have resulted in the elimination of connectors like na which do not contain any meaningful information for analysis.   \n~~what is amp?~~\n\n### What percentage of tweets contain links?\n\n* Vivo Energy are finishing people's bundles lol\n* Do tweets with links get more favs and retweets?\n* Are the links usually linking to photos? seems to be the case.\n* And when not linking to photo usually is a link to a status. i.e row reps a retweet.\n\n## Date of Postings\n\n\n```{r}\nvivo.tw <- vivo.tw %>% mutate(wday = wday(created_at, label=T),\n                              month = month(created_at, label=T),\n                              year = year(created_at) )\n```\n\n```{r}\nvivo.wd <- vivo.tw %>% group_by(wday) %>% summarise(Tally = n())\nvivo.wd\n```\n\nDistribution is multimodal i.e more than one peak. And can be said to be almost uniform. There tends not to be a large disparity between the tweets posted on different days.\nCompare different themes and widths to see which is best. Try theme minimal.\n\n```{r wdayBar}\nggplot(vivo.wd, aes(x=wday, y=Tally) ) +\n  geom_bar(stat = \"identity\", width = 0.5) +\n  labs(x=NULL) +\n  theme_solarized() +\n  expand_limits(y=c(0,600))\n```\n\n## At what time are most tweets posted?\n\nThe Vivo Energy twitter handle is most active in the middle of the day, particularly from 7am to 3pm, ~~a la normal working hours~~. As can be seen in the graph below.\n\n```{r}\n# round off the dates to the nearest hour\nvivo.tw$rounded_time <- vivo.tw$created_at %>% round_date(\"hour\") %>% hour()\n```\n\n```{r timePlot}\n# frequency polygon\nggplot(data=vivo.tw, aes(rounded_time) ) +\n  geom_bar(stat = \"count\") +\n  theme_solarized() +\n  scale_x_continuous(breaks=seq.int(2,20,2), labels = paste0(c(seq.int(2,12,2),c(seq.int(2,8,2))),rep(c(\"am\",\"noon\",\"pm\"), c(5,1,4) ) ) ) +\n  labs(x=NULL, y=\"Count\")\n```\n\nTime of day key:  \n\n* morning 5am to 12pm  \n* afternoon 12pm to 5pm  \n* Evening 5pm to 9pm  \n* Night 9pm to 4am  \n\n### Does the time of posting affect how many likes and retweets?\n\n```{r}\nvivo.tw %>% group_by(rounded_time) %>% summarise(median_f=median(favorite_count),median_rt=median(retweet_count))\n# finding the values contained in a particular rounded hour\n#vivo.tw %>% filter(rounded_time==19) %>% select(favorite_count,retweet_count)\n```\n\n```{r boxFavCount}\nggplot(data = vivo.tw, aes(x=rounded_time, y=favorite_count+1, group=rounded_time)) +\n  geom_boxplot() +\n  labs(x=NULL,y=NULL, title=\"BoxPlot of Favourite Count per Hour\") +\n  scale_x_continuous(breaks=seq.int(2,20,2), labels = paste0(c(seq.int(2,12,2),c(seq.int(2,8,2))),rep(c(\"am\",\"noon\",\"pm\"), c(5,1,4) ) ) ) +\n  scale_y_continuous(trans = \"log\") +\n  theme_solarized()\n```\n\n```{r BoxRtCount}\nggplot(data = vivo.tw, aes(x=rounded_time, y=retweet_count+1, group=rounded_time)) +\n  geom_boxplot() +\n  labs(x=NULL,y=NULL,title=\"BoxPlot of Retweet Count per Hour\") +\n  scale_x_continuous(breaks=seq.int(2,20,2), labels = paste0(c(seq.int(2,12,2),c(seq.int(2,8,2))),rep(c(\"am\",\"noon\",\"pm\"), c(5,1,4) ) ) ) +\n  coord_cartesian(ylim = c(0,60)) +\n  theme_solarized()#+\n  scale_y_continuous(trans = \"log\") \n```\nHow to interpret given that different times have different number of tweets which influences the median.  \nAlso should i use a log scale or stick with the normal scale?\nThere are only slight diffences in the medians across time. It would seem that the time of posting is not the greatest predictor of the number of likes or retweets.  \nTo quash any lingering doubt or to more formally test this assumption i run a linear model using time of day as a predictor. I forsee a problem of serial correlation due to omitted variable bias. Think of other variables that explain the regressand (in this case popularity metric).  \n\n## Sentiment Analysis\n\nFor the sentiment analysis i shall use the AFINN dictionary which scores sentiments, ranking them from 3 to -3 indicating the degree of positiveness or negative sentiment where positive values represent positive sentiments and negative values represent negative sentiments.     \nHow to classify sentiments? weekly? monthly? yearly?  \n```{r getSentiments}\nafinn <- get_sentiments(lexicon = \"afinn\")\n\npop_tidy.s <- vivo.tw\npop_tidy.s$text <- gsub('http.*\\\\s*', '', pop_tidy.s$text)\npop_tidy.s <- pop_tidy.s %>% filter(!is_retweet==TRUE) %>% select(text,33:35) %>% unnest_tokens(word,text) %>% \n  inner_join(afinn, by =c(\"word\"=\"word\"))\nrm(afinn)\n```\n\n\n```{r monthSent16}\nx <- pop_tidy.s %>% group_by(month,year) %>% summarise(total_score=sum(score))\n\nplotx<- ggplot(filter(x, year==2016), aes(x=month, y=total_score)) +\n  geom_bar(stat = \"identity\", width = 0.5) +\n  labs(x=NULL, y=\"Total Score\", title=\"Total Sentiment Score 2016\") +\n  theme_solarized()\n#rm(x)\n```\nOverall for the year 2016 the sentiments are positive, with February and December having especially positive sentiments.  \nNot very intuitive. Better a wordcloud with negative sentiment words?  \n\nCompare to number of tweets in each month.\n```{r}\n# Count of tweets with sentiments in each month\ny <- pop_tidy.s %>% filter(year==2016) %>% group_by(month) %>% summarise(Tally=n())\nploty<- ggplot(data = y, aes(x=month,y=Tally)) +\n  geom_bar(stat = \"identity\", width = 0.5) +\n  theme_solarized() +\n  labs(x=NULL, title=\"Total Tweets Per Month in 2016\")\n```\n\n```{r}\ngrid.arrange(plotx,ploty)\n```\nAs can be seen the total sentiment score is not a good indicator as its susceptible to scale i.e The total sentiment score closely resembles the total tweets per month. For a better indicator i turn to the median sentiment as the mean as a measure is susceptible to outliers.  \n\n```{r monthSent17}\nx <- pop_tidy.s %>% group_by(month,year) %>% summarise(total_score=sum(score))\n\nggplot(filter(x, year==2017), aes(x=month, y=total_score)) +\n  geom_bar(stat = \"identity\", width = 0.6) +\n  labs(x=NULL, y=\"Total Score\",title=\"Total Sentiment Score 2017\") +\n  theme_solarized()\nrm(x)\n```\nAs opposed to obtaining the sum of the sentiment scores. Because the sum is susceptible to scale. How about obtaining the median as a better representation of the actual sentiment during the period. In which case it would rank from 3 for the highest positive score to -3 for the highest negative score.  \nOr if not then use the sum just a means of a general look at sentiment.\n\n## What devices are used to tweet?\n```{r tweetSource}\nvivo.tw %>% group_by(source) %>% summarise(Tally=n())\n```\nThe most commonly used device to tweet is the twitter android app closely followed by the twitter web client which together account for more than half of all tweets. The presence of Periscope indicates that there have been a couple of live broadcasts.\n\n```{r}\nvivo.tw$place_name %>% unique()\n```\n\n\n## Other Questions\n\n* Device used by the handle to tweet.\n    + Does it have any impact on sentiment of the tweet?\n* When(time) does the handle tweet?\n* Linear regression of fav count and retweet count.\n* Does the handle use emoji?\n    + If so, which is the most used emoji?\n    + Are the sentiments in the emoji tweet positive or negative?\n* Geo-spatial analysis of the locations Vivo Energy tweets from.  \n\n\nMake a bayesian analysis. i.e a table with links on one end and time of day on other. Perhaps think of better vaiables?\nAnd find marginal and conditional probabilities.  \n\nAdd titles and subtitles to graphs. With the subtitle having a lighter shade than the title. \n",
    "created" : 1493881364940.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3297106568",
    "id" : "88902625",
    "lastKnownWriteTime" : 1494420605,
    "last_content_update" : 1494420605076,
    "path" : "D:/Programming/R Work Space/VIVO ENERGY/vivoNoteBook.Rmd",
    "project_path" : "vivoNoteBook.Rmd",
    "properties" : {
        "chunk_output_type" : "inline",
        "last_setup_crc32" : "F2EA4FDEf6b29497",
        "tempName" : "Untitled1"
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}